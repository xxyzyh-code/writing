<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æœ«æ—¥æŠ‰æ‹©ï¼šæ•´åˆç‰ˆ</title>
  <style>
    body { font-family: "å¾®è½¯é›…é»‘", sans-serif; background: #111; color: #eee; padding: 20px; }
    .choice { margin: 10px 0; padding: 10px; background: #333; cursor: pointer; border-radius: 5px; }
    .choice:hover { background: #555; }
    #status { margin-top: 20px; font-size: 14px; color: #ccc; }
  </style>
</head>
<body>

<!-- å°é¢ç•Œé¢ -->
<div id="cover">
  <h2>ğŸŒ† æœ«æ—¥æŠ‰æ‹©</h2>
  <p>ä¸§å°¸ç—…æ¯’å¸­å·å…¨çƒï¼Œæ–‡æ˜å´©å¡Œã€‚ä½ æ˜¯æœ€åçš„å¹¸å­˜è€…ä¹‹ä¸€ã€‚</p>
  <p>ä½ èƒ½åœ¨è¿™ä¸ªä¸–ç•Œä¸­æ´»ä¸‹æ¥å—ï¼Ÿ</p>
  <div class="choice" onclick="startGame()">â–¶ï¸ å¼€å§‹æ¸¸æˆ</div>
</div>

<!-- æ€§åˆ«é€‰æ‹©ç•Œé¢ -->
<div id="gender" style="display:none;">
  <h3>è¯·é€‰æ‹©è§’è‰²æ€§åˆ«ï¼š</h3>
  <div class="choice" onclick="chooseGender('male')">ğŸ‘¨ ç”·ä¸»ï¼šä½“åŠ›æ›´å¼ºï¼ˆHP +20ï¼‰</div>
  <div class="choice" onclick="chooseGender('female')">ğŸ‘© å¥³ä¸»ï¼šæ›´å…·åŒç†å¿ƒï¼ˆä¿¡ä»»å€¼ +20ï¼‰</div>
</div>

<!-- æ¸¸æˆä¸»ç•Œé¢ -->
<div id="main" style="display:none;">
  <h1>ğŸ§Ÿâ€â™‚ï¸ æœ«æ—¥æŠ‰æ‹©ï¼šæ•´åˆç‰ˆ</h1>
  <div id="story"></div>
  <div id="choices"></div>
  <div id="status"></div>
</div>

<script>
let player = {
  hp: 100,
  trust: 50,
  morality: 0,
  time: { day: 1, hour: 8 },
  inventory: []
};
let chapter = 1;
let activeTimeouts = [];

function startGame() {
  document.getElementById("cover").style.display = "none";
  document.getElementById("gender").style.display = "block";
}

function chooseGender(gender) {
  document.getElementById("gender").style.display = "none";
  document.getElementById("main").style.display = "block";
  if (gender === 'male') {
    player.hp += 20;
  } else {
    player.trust += 20;
  }
  startChapter1();
}

function advanceTime(hours) {
  player.time.hour += hours;
  if (player.time.hour >= 24) {
    player.time.day += 1;
    player.time.hour -= 24;
  }
}

function updateStatus() {
  document.getElementById("status").innerHTML =
    `ğŸ©¸ HP: ${player.hp} ï½œ ğŸ¤ ä¿¡ä»»å€¼: ${player.trust} ï½œ ğŸ§  é“å¾·å€¼: ${player.morality} ï½œ â³ æ—¶é—´: Day ${player.time.day}, ${player.time.hour}:00 ï½œ ğŸ’ èƒŒåŒ…: ${player.inventory.length ? player.inventory.join(", ") : "ç©º"}`;
}

function clearAllTimeouts() {
  activeTimeouts.forEach(id => clearTimeout(id));
  activeTimeouts = [];
}

function restartGame() {
  clearAllTimeouts();
  player = {
    hp: 100,
    trust: 50,
    morality: 0,
    time: { day: 1, hour: 8 },
    inventory: []
  };
  chapter = 1;
  document.getElementById("choices").style.display = "block";
  startChapter1();
}

function showEnding() {
  let ending = "";
  if (player.hp <= 0) {
    ending = "â˜ ï¸ ç»“å±€ï¼šæ­»äº¡ â€” ä½ æœªèƒ½åœ¨æœ«æ—¥ä¸­å¹¸å­˜ã€‚";
  } else if (player.trust >= 70 && player.morality >= 15) {
    ending = "ğŸŒˆ ç»“å±€ï¼šå¸Œæœ› â€” ä½ ç”¨å–„è‰¯ä¸ä¿¡ä»»èµ¢å¾—äº†ç”Ÿå­˜ä¸æœªæ¥ã€‚";
  } else if (player.trust < 30) {
    ending = "ğŸ§Š ç»“å±€ï¼šå­¤ç‹¬ â€” ä½ æ´»äº†ä¸‹æ¥ï¼Œä½†å¤±å»äº†äººæ€§ä¸é™ªä¼´ã€‚";
  } else {
    ending = "âš–ï¸ ç»“å±€ï¼šæŒ£æ‰ â€” ä½ å‹‰å¼ºæ´»ç€ï¼Œä½†ä»£ä»·æ²‰é‡ã€‚";
  }

  document.getElementById("story").innerHTML += `<p><strong>${ending}</strong></p>`;
  document.getElementById("choices").innerHTML = `
    <div class="choice" onclick="restartGame()">ğŸ” é‡æ–°å¼€å§‹æ¸¸æˆ</div>
  `;
  document.getElementById("choices").style.display = "block";
}

// ç¬¬ä¸€ç« 
function startChapter1() {
  document.getElementById("story").innerHTML =
    "<p>ä¸§å°¸ç—…æ¯’çˆ†å‘ç¬¬7å¤©ï¼Œä½ ç‹¬è‡ªèº²åœ¨åºŸå¼ƒå›¾ä¹¦é¦†ä¸­ã€‚çª—å¤–ä¼ æ¥æ±‚æ•‘å£°ï¼Œä½ å¿…é¡»åšå‡ºé€‰æ‹©ï¼š</p>";
  document.getElementById("choices").innerHTML = `
    <div class="choice" onclick="chapter1('saint')">1ï¸âƒ£ åœ£æ¯æ¨¡å¼ï¼šæ¥çº³æ‰€æœ‰äºº</div>
    <div class="choice" onclick="chapter1('hermit')">2ï¸âƒ£ éšå±…æ¨¡å¼ï¼šæ‹’ç»æ‰€æœ‰äºº</div>
    <div class="choice" onclick="chapter1('selective')">3ï¸âƒ£ æœ‰é™æ¥çº³ï¼šåªæ¥çº³è€äººå’Œå­©å­</div>
  `;
  updateStatus();
}

function chapter1(option) {
  document.getElementById("choices").style.display = "none";
  if (option === 'saint') {
    player.trust += 20;
    player.morality += 10;
    player.inventory.push("ä¸­å¹´ç”·å­");
    document.getElementById("story").innerHTML =
      "<p>ä½ æ‰“å¼€äº†é—¨ï¼Œè¿æ¥ä»–ä»¬è¿›æ¥ã€‚å­©å­æ‰‘è¿›ä½ æ€€é‡Œå“­æ³£ï¼Œè€äººè¿å£°é“è°¢ã€‚ä¸­å¹´ç”·å­æ²‰é»˜ä¸è¯­ï¼Œæ‰‹ä¸­ç´§æ¡ç€èƒŒåŒ…ã€‚</p>";
  } else if (option === 'hermit') {
    player.trust -= 10;
    player.morality -= 5;
    document.getElementById("story").innerHTML =
      "<p>ä½ å…³ä¸Šäº†é—¨ï¼Œä»»ç”±æ•²é—¨å£°æ¸æ¸è¿œå»ã€‚ä½ çŸ¥é“ï¼Œè¿™å¯èƒ½æ˜¯ä½ æœ€åä¸€æ¬¡å¬åˆ°äººç±»çš„å£°éŸ³ã€‚</p>";
  } else {
    player.trust += 5;
    player.morality += 2;
    player.inventory.push("è€äºº", "å­©å­");
    document.getElementById("story").innerHTML =
      "<p>ä½ åªæ‰“å¼€ä¸€æ¡ç¼ï¼Œè®©è€äººå’Œå­©å­è¿›æ¥ã€‚ä¸­å¹´ç”·å­æ€’è§†ä½ ä¸€çœ¼ï¼Œè½¬èº«ç¦»å»ã€‚</p>";
  }
  advanceTime(2);
  updateStatus();
  activeTimeouts.push(setTimeout(startChapter2, 2000));
}

// ç¬¬äºŒç« 
function startChapter2() {
  if (!player.inventory.includes("ä¸­å¹´ç”·å­")) {
    document.getElementById("story").innerHTML =
      "<p>å¤œå¹•é™ä¸´ï¼Œæ¥¼ä¸‹ä¼ æ¥è„šæ­¥å£°ã€‚ä½ ç‹¬è‡ªå†³å®šå¦‚ä½•åº”å¯¹ã€‚</p>";
    document.getElementById("choices").innerHTML = `
      <div class="choice" onclick="chapter2('solo')">1ï¸âƒ£ ç‹¬è‡ªä¸‹æ¥¼æŸ¥çœ‹</div>
      <div class="choice" onclick="chapter2('wait')">2ï¸âƒ£ å°é”æ¥¼æ¢¯ï¼Œç­‰å¾…å¤©äº®</div>
    `;
  } else {
    document.getElementById("story").innerHTML =
      "<p>å¤œå¹•é™ä¸´ï¼Œæ¥¼ä¸‹ä¼ æ¥è„šæ­¥å£°ã€‚ä½ å¿…é¡»å†³å®šå¦‚ä½•åº”å¯¹ã€‚</p>";
    document.getElementById("choices").innerHTML = `
      <div class="choice" onclick="chapter2('solo')">1ï¸âƒ£ ç‹¬è‡ªä¸‹æ¥¼æŸ¥çœ‹</div>
      <div class="choice" onclick="chapter2('team')">2ï¸âƒ£ å«ä¸Šä¸­å¹´ç”·å­åŒè¡Œ</div>
      <div class="choice" onclick="chapter2('wait')">3ï¸âƒ£ å°é”æ¥¼æ¢¯ï¼Œç­‰å¾…å¤©äº®</div>
    `;
  }
  document.getElementById("choices").style.display = "block";
}

function chapter2(option) {
  document.getElementById("choices").style.display = "none";
  if (option === 'solo') {
    let encounter = Math.random();
    if (encounter < 0.4) {
      player.inventory.push("æ€¥æ•‘åŒ…");
      document.getElementById("story").innerHTML =
        "<p>ä½ åœ¨æ¥¼ä¸‹å‘ç°ä¸€ä¸ªæ€¥æ•‘åŒ…ï¼Œå¹¸è¿åœ°æ²¡æœ‰é‡åˆ°ä¸§å°¸ã€‚</p>";
    } else {
      player.hp -= 20;
      document.getElementById("story").innerHTML =
        "<p>ä½ è¢«ä¸§å°¸å·è¢­ï¼Œå—ä¼¤äº†ï¼ä½ å‹‰å¼ºé€ƒå›æ¥¼ä¸Šã€‚</p>";
    }
  } else if (option === 'team') {
    let betrayal = Math.random();
    if (betrayal < 0.3) {
      player.hp -= 30;
      player.trust -= 20;
      document.getElementById("story").innerHTML =
        "<p>ä¸­å¹´ç”·å­çªç„¶è¢­å‡»ä½ ï¼ä½ å—ä¼¤ä¸¥é‡ï¼Œä¿¡ä»»å€¼ä¸‹é™ã€‚</p>";
    } else {
      player.trust += 10;
      document.getElementById("story").innerHTML =
        "<p>ä½ ä»¬åä½œé¡ºåˆ©ï¼Œå‘ç°æ¥¼ä¸‹æ— äººï¼Œä¿¡ä»»å€¼æå‡ã€‚</p>";
    }
  } else {
    advanceTime(8);
    document.getElementById("story").innerHTML =
      "<p>ä½ å°é”äº†æ¥¼æ¢¯ï¼Œæ•´æ™šæœªçœ ã€‚å¤©äº®äº†ï¼Œä½†ä½ é”™è¿‡äº†æ¥¼ä¸‹çš„åŠ¨é™ã€‚</p>";
  }
  advanceTime(2);
  updateStatus();
  activeTimeouts.push(setTimeout(startChapter3, 2000));
}

// ç¬¬ä¸‰ç« ï¼ˆä¿®æ­£ç‰ˆï¼‰
function startChapter3() {
  if (!player.inventory.includes("ä¸­å¹´ç”·å­")) {
    document.getElementById("story").innerHTML =
      "<p>æ¸…æ™¨ï¼Œä½ ç‹¬è‡ªé†’æ¥ã€‚å››å‘¨å®‰é™å¾—å¯æ€•ã€‚ä½ å¿…é¡»å†³å®šæ˜¯å¦ç»§ç»­åšå®ˆæˆ–å¤–å‡ºæ¢ç´¢ã€‚</p>";
    document.getElementById("choices").innerHTML = `
      <div class="choice" onclick="startChapter4()">â¡ï¸ ç»§ç»­å‰è¿›</div>
    `;
    return;
  }

  document.getElementById("choices").style.display = "block";
  document.getElementById("story").innerHTML =
    "<p>æ¸…æ™¨ï¼Œä½ å‘ç°ä¸­å¹´ç”·å­çš„è¢–å£æ²¾æœ‰è¡€è¿¹ã€‚ä»–å£°ç§°æ˜¯æ“¦ä¼¤ï¼Œä½†å­©å­è¯´ä»–æ˜¨æ™šå·å·ä¸‹æ¥¼ã€‚ä½ å¿…é¡»å†³å®šå¦‚ä½•å¤„ç†ã€‚</p>";
  document.getElementById("choices").innerHTML = `
    <div class="choice" onclick="chapter3('confront')">1ï¸âƒ£ è´¨é—®ä»–æ˜¯å¦è¢«æ„ŸæŸ“</div>
    <div class="choice" onclick="chapter3('search')">2ï¸âƒ£ å·å·æ£€æŸ¥ä»–çš„èƒŒåŒ…</div>
    <div class="choice" onclick="chapter3('trust')">3ï¸âƒ£ é€‰æ‹©ç›¸ä¿¡ä»–ï¼Œç»§ç»­å…±å¤„</div>
  `;
}

function chapter3(option) {
  document.getElementById("choices").style.display = "none";
  if (option === 'confront') {
    let infected = Math.random();
    if (infected < 0.5) {
      player.trust -= 30;
      player.hp -= 20;
      document.getElementById("story").innerHTML =
        "<p>ä½ å‘ç°ä»–æ‰‹è‡‚ä¸Šæœ‰å’¬ç—•ã€‚ä»–çªç„¶æš´èµ·æ”»å‡»ï¼Œä½ ç”¨æ—§åˆ€åå‡»ï¼Œå—ä¼¤ä½†å¹¸å­˜ã€‚</p>";
    }
  } else if (option === 'search') {
    let found = Math.random();
    if (found < 0.4) {
      player.inventory.push("æŠ—ç—…æ¯’è¯å‰‚");
      player.trust += 10;
      document.getElementById("story").innerHTML =
        "<p>ä½ åœ¨ä»–èƒŒåŒ…ä¸­å‘ç°ä¸€ç“¶æŠ—ç—…æ¯’è¯å‰‚ã€‚ä»–å¯èƒ½æ˜¯å¹¸å­˜è€…ç»„ç»‡çš„ä¸€å‘˜ã€‚</p>";
    } else {
      player.trust -= 15;
      document.getElementById("story").innerHTML =
        "<p>ä½ ä»€ä¹ˆä¹Ÿæ²¡å‘ç°ï¼Œä½†ä»–å¯Ÿè§‰äº†ä½ çš„è¡Œä¸ºï¼Œä¿¡ä»»å€¼ä¸‹é™ã€‚</p>";
    }
  } else {
    player.morality += 5;
    player.trust += 10;
    player.inventory.push("ç“¶è£…æ°´");
    document.getElementById("story").innerHTML =
      "<p>ä½ é€‰æ‹©ç›¸ä¿¡ä»–ã€‚ä»–æ²‰é»˜ç‰‡åˆ»ï¼Œéšåé€’ç»™ä½ ä¸€ç“¶æ°´ï¼Œè¯´ï¼šâ€œè°¢è°¢ä½ è¿˜æ„¿æ„ç›¸ä¿¡äººã€‚â€</p>";
  }
  advanceTime(2);
  updateStatus();
  activeTimeouts.push(setTimeout(startChapter4, 2000));
}

// ç¬¬å››ç« 
function startChapter4() {
  document.getElementById("choices").style.display = "block";
  document.getElementById("story").innerHTML =
    "<p>æ¸…æ™¨ï¼Œä½ åœ¨å›¾ä¹¦é¦†å¤–å‘ç°ä¸€è¾†ç¿»å€’çš„è¡¥ç»™è½¦ã€‚é™„è¿‘æœ‰å…¶ä»–å¹¸å­˜è€…æ­£åœ¨é è¿‘ã€‚ä½ å¿…é¡»å†³å®šæ˜¯å¦äº‰å¤ºèµ„æºã€‚</p>";
  document.getElementById("choices").innerHTML = `
    <div class="choice" onclick="chapter4('fight')">1ï¸âƒ£ å†²è¿‡å»æŠ¢å¤ºèµ„æº</div>
    <div class="choice" onclick="chapter4('negotiate')">2ï¸âƒ£ å°è¯•ä¸å¯¹æ–¹è°ˆåˆ¤</div>
    <div class="choice" onclick="chapter4('retreat')">3ï¸âƒ£ æ”¾å¼ƒäº‰å¤ºï¼Œæ‚„æ‚„ç¦»å¼€</div>
  `;
}

function chapter4(option) {
  document.getElementById("choices").style.display = "none";
  if (option === 'fight') {
    let outcome = Math.random();
    if (outcome < 0.5) {
      player.hp -= 30;
      player.inventory.push("ç½å¤´x3", "ç”µæ± ");
      document.getElementById("story").innerHTML =
        "<p>ä½ ä¸å¯¹æ–¹å‘ç”Ÿå†²çªï¼Œè™½ç„¶å—ä¼¤ï¼Œä½†æˆåŠŸæŠ¢åˆ°ç‰©èµ„ã€‚</p>";
    } else {
      player.hp -= 50;
      document.getElementById("story").innerHTML =
        "<p>ä½ è¢«å¯¹æ–¹å‡»é€€ï¼Œä¸¥é‡å—ä¼¤ï¼Œæœªèƒ½è·å¾—ä»»ä½•èµ„æºã€‚</p>";
    }
  } else if (option === 'negotiate') {
    let success = Math.random();
    if (success < 0.6) {
      player.trust += 15;
      player.inventory.push("æ°´ç“¶", "è¯è‰");
      document.getElementById("story").innerHTML =
        "<p>ä½ æˆåŠŸä¸å¯¹æ–¹è¾¾æˆåè®®ï¼ŒåŒæ–¹å¹³åˆ†èµ„æºï¼Œä¿¡ä»»å€¼æå‡ã€‚</p>";
    } else {
      player.trust -= 10;
      document.getElementById("story").innerHTML =
        "<p>å¯¹æ–¹æ‹’ç»è°ˆåˆ¤å¹¶é©±èµ¶ä½ ï¼Œä½ ç©ºæ‰‹è€Œå½’ã€‚</p>";
    }
  } else {
    player.morality += 5;
    document.getElementById("story").innerHTML =
      "<p>ä½ é€‰æ‹©é¿å…å†²çªï¼Œæ‚„æ‚„ç¦»å¼€ã€‚è™½ç„¶æ²¡æœ‰è·å¾—èµ„æºï¼Œä½†ä½ ä¿ä½äº†å®‰å…¨ä¸é“å¾·ã€‚</p>";
  }

  advanceTime(2);
  updateStatus();
  activeTimeouts.push(setTimeout(startChapter5, 2000));
}

// ç¬¬äº”ç« 
function startChapter5() {
  document.getElementById("choices").style.display = "block";
  document.getElementById("story").innerHTML =
    "<p>å›¾ä¹¦é¦†å¤–ä¼ æ¥çˆ†ç‚¸å£°ï¼Œä¸§å°¸ç¾¤æ­£åœ¨é€¼è¿‘ã€‚ä½ å¿…é¡»å†³å®šæ˜¯å¦é€ƒç¦»ï¼Œæˆ–åšå®ˆç­‰å¾…æ•‘æ´ã€‚</p>";
  document.getElementById("choices").innerHTML = `
    <div class="choice" onclick="chapter5('escape')">1ï¸âƒ£ å†’é™©é€ƒç¦»å›¾ä¹¦é¦†</div>
    <div class="choice" onclick="chapter5('stay')">2ï¸âƒ£ åšå®ˆç­‰å¾…æ•‘æ´</div>
  `;
}

function chapter5(option) {
  document.getElementById("choices").style.display = "none";
  advanceTime(4);

  if (option === 'escape') {
    let chance = Math.random();
    if (player.hp > 50 && chance < 0.6) {
      player.hp -= 20;
      player.trust += 10;
      document.getElementById("story").innerHTML =
        "<p>ä½ æˆåŠŸé€ƒå‡ºå›¾ä¹¦é¦†ï¼Œé€”ä¸­å—ä¼¤ä½†å¹¸å­˜ã€‚ä½ åœ¨åºŸå¢Ÿä¸­æ‰¾åˆ°ä¸€è¾†è½¦ï¼Œé©¶å‘æœªçŸ¥ã€‚</p>";
    } else {
      player.hp = 0;
      document.getElementById("story").innerHTML =
        "<p>ä½ åœ¨é€ƒäº¡é€”ä¸­è¢«ä¸§å°¸å›´æ”»ï¼Œæœ€ç»ˆåŠ›ç«­å€’ä¸‹ã€‚é»‘æš—åå™¬äº†ä½ ã€‚</p>";
    }
  } else {
    if (player.trust >= 60 && player.morality >= 10) {
      document.getElementById("story").innerHTML =
        "<p>ä½ åšå®ˆå›¾ä¹¦é¦†ï¼Œæœ€ç»ˆè¢«å¹¸å­˜è€…ç»„ç»‡å‘ç°å¹¶æ•‘æ´ã€‚ä½ çš„ä¿¡ä»»ä¸å–„è‰¯æ‹¯æ•‘äº†ä½ å’Œä»–äººã€‚</p>";
    } else {
      player.hp -= 40;
      document.getElementById("story").innerHTML =
        "<p>ä½ ç­‰å¾…äº†å¤ªä¹…ï¼Œèµ„æºè€—å°½ï¼Œæ„ŸæŸ“è”“å»¶ã€‚ä½ åœ¨å­¤ç‹¬ä¸­æ­»å»ã€‚</p>";
    }
  }

  updateStatus();
  showEnding();
}
</script>
</body>
</html>
